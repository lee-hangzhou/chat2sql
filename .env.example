
# 基础配置

# 运行环境：dev / prod
ENV=dev

# 调试模式：true / false
DEBUG=true

# 后端服务端口，本地开发时 Makefile 的 make dev 会读取此值
PORT=8000

# 数据库

# MySQL root 密码
# docker-compose.yml 中 mysql 服务和 app 服务均引用此变量
# 修改此值后，DATABASE_URL 和 BUSINESS_DATABASE_URL 中的密码也要同步
MYSQL_ROOT_PASSWORD=chat2sql

# 应用数据库连接地址（存储用户、会话等应用数据）
# 本地开发使用 localhost，Docker 部署时由 docker-compose.yml 覆盖为容器服务名
DATABASE_URL=mysql://root:chat2sql@localhost:3306/chat2sql

# [必填] 业务数据库连接地址（NL2SQL 查询执行的目标库）
# 替换为你实际要查询的数据库，密码需与 MYSQL_ROOT_PASSWORD 一致
# Docker 部署时，docker-compose.yml 会将 localhost 覆盖为 mysql（容器服务名）
BUSINESS_DATABASE_URL=mysql://root:chat2sql@localhost:3306/your_business_db

# Redis
# Docker 部署时由 docker-compose.yml 覆盖为 redis://redis:6379/0
REDIS_URL=redis://localhost:6379/0
REDIS_MAX_CONNECTIONS=10

# JWT 认证
# Token 签名密钥，生产环境务必修改
# docker-compose.yml 中 app 服务引用此变量
JWT_SECRET_KEY=dev-secret-key-change-in-production
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7

# CORS 跨域
# 允许跨域的前端地址，多个用逗号分隔
CORS_ORIGINS=http://localhost:3000,http://localhost:8000

# 日志级别：DEBUG / INFO / WARNING / ERROR
LOG_LEVEL=INFO
# 日志格式：json / console
LOG_FORMAT=json

# [必填] LLM 配置
# 二选一，只保留一组生效的配置，另一组注释掉
# 方式一：OpenAI 等云服务
OPENAI_API_KEY=sk-xxxx
OPENAI_MODEL=gpt-4o-mini
# OPENAI_BASE_URL=
#
# 方式二：Ollama 等本地模型（注释掉上面三行，取消下面三行的注释）
# OPENAI_API_KEY=ollama
# OPENAI_MODEL=qwen3:8b
# OPENAI_BASE_URL=http://localhost:11434/v1
#
# 注意：Docker 部署时容器内 localhost 指向容器自身，无法访问宿主机的 Ollama
# 需改为 http://host.docker.internal:11434/v1（macOS/Windows）
# 或 http://172.17.0.1:11434/v1（Linux）

# LLM 单次请求超时时间
LLM_TIMEOUT=300
# LLM 客户端自动重试次数
LLM_MAX_RETRIES=3
# LangChain with_retry 重试次数
LLM_RETRY_ATTEMPTS=3

# Milvus 连接地址
# Docker 部署时由 docker-compose.yml 覆盖为 http://milvus-standalone:19530
MILVUS_URI=http://localhost:19530
# 表结构存储的 Collection 名称
MILVUS_COLLECTION_NAME=table_schemas
# Collection 中存储表结构文本的标量字段名
MILVUS_SCHEMA_FIELD=table_schema
# 向量检索返回的最大表结构数量
MILVUS_SEARCH_LIMIT=3
# 嵌入模型名称（首次启动时自动下载，约 1.3GB）
EMBEDDING_MODEL=BAAI/bge-large-zh-v1.5

# Agent 参数
# SQL 校验失败时的最大重试次数
AGENT_MAX_RETRIES=3
# Schema 不足时的最大重新检索次数
AGENT_MAX_SCHEMA_RETRIES=3
# 追问澄清的最大轮数
AGENT_MAX_FOLLOW_UPS=3
# LangGraph 递归深度上限
AGENT_RECURSION_LIMIT=25
# Prompt 中保留的最大对话轮数（防止 Prompt 无限膨胀）
AGENT_MAX_MESSAGE_PAIRS=5
# EXPLAIN 执行计划中允许的最大扫描行数
EXPLAIN_MAX_ROWS=10000
# 最终 SQL 执行结果的最大返回行数
EXECUTOR_MAX_ROWS=1000
# 每次生成的候选 SQL 数量
SQL_CANDIDATE_COUNT=2
# 候选 SQL 生成时的温度（>0 以产生多样性）
SQL_CANDIDATE_TEMPERATURE=0.7

# Phoenix OpenTelemetry Collector 地址
# Docker 部署时由 docker-compose.yml 覆盖为 http://phoenix:4317
PHOENIX_COLLECTOR_ENDPOINT=http://localhost:4317

# Agent 状态持久化
# 可选值：memory（开发用，重启丢失）/ sqlite / postgres
CHECKPOINTER_TYPE=memory
# sqlite 模式下的数据库文件路径
CHECKPOINTER_SQLITE_PATH=./checkpoints.db
# postgres 模式下的连接地址
# CHECKPOINTER_POSTGRES_URI=postgresql://user:pass@localhost:5432/checkpoints
